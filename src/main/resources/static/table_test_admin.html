<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-table.min.css">
    <link rel="stylesheet" href="css/bootstrap-editable.css" type="text/css">
</head>

<body>

    <script>

    </script>
    <div class="container">
        <div>
            <button id="build" class="btn btn-default">Build</button>
            <button id="delete" class="btn btn-default">Delete</button>
            <button id="blank" class="btn btn-default">Add a blank line</button>
        </div>
        <div class=table-responsive">
            <table id="table" class="table text-nowrap" data-toggle="table" data-show-columns="true" data-search="true"
                data-show-refresh="true" data-show-toggle="true" data-pagination="true" data-height="500">
                <thead>
                    <tr>
                        <th data-field="book_id">ID</th>
                        <th data-field="book_name">书名</th>
                        <th data-field="author">作者</th>
                        <th data-field="collection_number">总数</th>
                        <th data-field="existing_number">现有</th>
                        <th data-field="price">价格</th>
                        <th data-field="publisher">出版社</th>
                        <th data-field="introduction">介绍</th>
                        <th data-field="operation">操作</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <style>
        .page-content-wrapper {
            width: 800px;
            position: absolute;
            top: 10%;
            left: 24%;
            background: #fff;
            border: 1px solid #999;
            padding: 3% 0 0 9%;
            display: none;
        }

        .inputstyle {
            width: 60%;
            height: 34px;
            padding: 6px 12px;
            font-size: 14px;
            line-height: 1.42857143;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>

    <table id="mytab" class="table table-hover"></table>
    <!-- 新增和修改界面 -->
    <div class="page-content-wrapper">
        <input type="text" class="inputstyle" id="id" style="display: none;">
        <p>请选择编辑方式：</p>
        <div class="form-group">
            <label for="cbox1">修改数据：</label>
            <input type="checkbox" name="edit_way" id="cbox1" value="2">
            <label for="cbox1">添加数据：</label>
            <input type="checkbox" name="edit_way" id="cbox2" value="3">
        </div>
        <div class="form-group">
            <label>ID</label> <input type="text" class="inputstyle" id="book_id">
        </div>
        <div class="form-group">
            <label>书名</label> <input type="text" class="inputstyle" id="book_name">
        </div>
        <div class="form-group">
            <label>作者</label> <input type="text" class="inputstyle" id="author">
        </div>
        <div class="form-group">
            <label>总数</label> <input type="text" class="inputstyle" id="collection_number">
        </div>
        <div class="form-group">
            <label>现有</label> <input type="text" class="inputstyle" id="existing_number">
        </div>
        <div class="form-group">
            <label>价格</label> <input type="text" class="inputstyle" id="price">
        </div>
        <div class="form-group">
            <label>出版社</label> <input type="text" class="inputstyle" id="publisher">
        </div>
        <div class="form-group">
            <label>介绍</label> <input type="text" class="inputstyle" id="introduction">
        </div>


        <div class="modal-footer">
            <button type="button" class="btn default" data-dismiss="modal" id="close">Close</button>
            <button type="button" class="btn blue" id="updateBtn">Save</button>

        </div>
    </div>



    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!--<script src="assets/bootstrap2.3/js/bootstrap.min.js"></script>-->
    <script src="js/tableExport.js"></script>
    <script src="js/jquery.base64.js"></script>
    <script src="js/bootstrap-table.js"></script>
    <script src="js/bootstrap-table-export.js"></script>


    <script>


        //data-url="data/data1.json"
        $(function () {
            $('#build').click(build);//.trigger('click');
            $('#cells, #rows').keyup(function (e) {
                if (e.keyCode === 13) {
                    build();
                }
            });
        });

        function actionFormatter(value, row, index) {
            var id = value;
            var result = "";
            result += "<a href='javascript:;' class='btn btn-xs green' onclick=\"EditViewById('" + id + "', view='view')\" title='查看'><span class='glyphicon glyphicon-circle-arrow-up'></span></a>";
            result += "<a href='javascript:;' class='btn btn-xs blue' onclick=\"EditViewById('" + id + "')\" title='编辑'><span class='glyphicon glyphicon-circle-arrow-down'></span></a>";
            return result;
        }


        //表格超出宽度鼠标悬停显示td内容
        function paramsMatter(value, row, index) {
            var span = document.createElement("span");
            span.setAttribute("title", value);
            span.innerHTML = value;
            return span.outerHTML;
        }
        //td宽度以及内容超过宽度隐藏
        function formatTableUnit(value, row, index) {
            return {
                css: {
                    "white-space": "nowrap",
                    "text-overflow": "ellipsis",
                    "overflow": "hidden",
                    "max-width": "80px"
                }
            }
        }










        function build() {
            //这里写刷新表格连接数据库的报文

            // $.ajax({
            //     type: "POST",
            // //    url: "",这里填写数据库调用接口
            //     dataType: "json",
            //     data:{
            //         id:"1",
            //         kind:"0"},
            //     contentType : "application/json",
            //     success: function (data) {
            //         $('#table').bootstrapTable('destroy').bootstrapTable({
            //             columns: columns,
            //             data: data
            //         });
            //     },
            //     error: function () {
            //         alert("错误");
            //     }
            // });


            var columns = [

                // {
                //     field:'number',
                //     title:'index',
                //     formatter:indexFormatter,
                // },
                {
                    field: 'book_id',
                    title: 'ID',
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                }, {
                    field: 'book_name',
                    title: '书名',
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                    //editable:true,
                }, {
                    field: 'author',
                    title: '作者',
                    //editable:true,
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                }, {
                    field: 'collection_number',
                    title: '总数',
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                }, {
                    field: 'existing_number',
                    title: '现有',
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                }, {
                    field: 'price',
                    title: '价格',
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                }, {
                    field: 'publisher',
                    title: '出版社',
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                },
                {
                    field: 'introduction',
                    title: '介绍',
                    cellStyle: formatTableUnit,
                    formatter: paramsMatter,
                },
                {
                    checkbox: true,
                    visible: true                  //是否显示复选框
                },
                {
                    field: 'operation',
                    title: '操作',
                    align: 'center',
                    valign: 'middle',
                    formatter: option,
                    // formatter: actionFormatter
                },];




            var data = [
                {
                    book_id: "121312321",
                    book_name: "海底两万里",
                    author: "凡尔纳",
                    collection_number: "20",
                    existing_number: "30",
                    price: "30",
                    publisher: "新华出版社",
                    introduction: "的说法是的粉色调复活甲扫地机佛菩萨机打发票世纪东方平均速度批发价阿萨德寄发票",
                },
                {
                    book_id: "10",
                    book_name: "西游记",
                    author: "吴承恩",
                    collection_number: "10",
                    existing_number: "8",
                    price: "50",
                    publisher: "外文出版社",
                    introduction: "的撒发士大夫撒地方撒大哥发撒的发生大发生的发票世纪东方平均速度批发价阿萨德寄发票",
                }
            ]


            $('#table').bootstrapTable('destroy').bootstrapTable({
                columns: columns,
                data: data,
                clickToSelect: true,
                showPaginationSwitch: true,

            });


            $('#table').resize();

        }


        function option(value, row, index) {
            var htm = "";
            htm = '<button id="upd"  onclick="update(\'' + escape(JSON.stringify(row)) + '\')">Edit</button>';
            return htm;
        }

        function update(row) {
            $(".page-content-wrapper").show();
            var data = JSON.parse(unescape(row))
            $('#book_id').val(data.book_id)
            $('#book_name').val(data.book_name)
            $('#author').val(data.author)
            $('#collection_number').val(data.collection_number)
            $('#existing_number').val(data.existing_number)
            $('#price').val(data.price)
            $('#publisher').val(data.publisher)
            $('#introduction').val(data.introduction)

        }
        $("#close").on("click", function () {
            $(".page-content-wrapper").hide();
        })

        $("#blank").click(function () {
            var blank = {
                book_id: "",
                book_name: "",
                author: "",
                collection_number: "",
                existing_number: "",
                price: "",
                publisher: "",
                introduction: "",
            };
            $("#table").bootstrapTable('append', blank);
        });

        $("#delete").click(function () {
            var rows = $("#table").bootstrapTable('getSelections');
            console.log(rows);
            if (rows.length == 0) {
                alert("请先选择要删除的记录!");
                return;
            } else {
                if (confirm("确定要删除吗？")) {
                    var arrays = new Array();// 声明一个数组
                    $(rows).each(function () {// 通过获得别选中的来进行遍历
                        arrays.push(this.book_id);// cid为获得到的整条数据中的一列
                    });
                    var idcard = arrays.join(','); // 获得要删除的id
                    console.log(idcard);//idcard为要删除图书的id数组
                    // $.ajax({
                    //     type: "post",
                    //     url: "" ,    //填写数据库url
                    //     dataType: "json",
                    //     data:{
                    //         id:"3",
                    //         book_id:idcard,
                    //         kind:"0",
                    //         IOD:"1"
                    //     },
                    //     success: function () {
                    //         build();
                    //         alert("删除成功");
                    //         location = location;
                    //     },
                    //     error: function () {
                    //         alert('无法删除');
                    //     },
                    //     complete: function () {
                    //     }
                    // })
                }
                return;
            }
        });


        $("#updateBtn").on("click", function () {
            var obj = document.getElementsByName('edit_way'); //选择所有name="'edit_way'"的对象，返回数组
            //取到对象数组后，我们来循环检测它是不是被选中
            var s = '';
            for (var i = 0; i < obj.length; i++) {
                if (obj[i].checked) s += obj[i].value + ','; //如果选中，将value添加到变量s中
            }
            if (s.length == 0) {
                alert("还没有选择任何编辑方式！")
            }
            else if (s.length == 4) {
                alert("不能同时选择两种编辑方式！")
            }
            var edit_id = s[0];
            var book_id = $("#book_id").val();
            var book_name = $("#book_name").val();
            var author = $("#author").val();
            var collection_number = $("#collection_number").val();
            var existing_number = $("#existing_number").val();
            var price = $("#price").val();
            var publisher = $("#publisher").val();
            var introduction = $("#introduction").val();
            console.log(book_id)
            console.log(book_name)
            console.log(author)
            console.log(collection_number)
            console.log(existing_number)
            console.log(price)
            console.log(publisher)
            console.log(introduction)
            //下面填写ajax报文
            //     $.ajax({
            //     type: "post",
            //     url: "" ,  //填写数据库url
            //     dataType: "json",
            //     data:{
            //         id:edit_id,
            //         book_id:book_id,
            //         book_name:book_name,
            //         author:author,
            //         collection_number:collection_number,
            //         existing_number:existing_number,
            //         price:price,
            //         publisher:publisher,
            //         introduction:introduction,
            //     },
            //     success: function () {
            //         $("#table").bootstrapTable('refresh');
            //         alert("提交成功");
            //         location = location;
            //     },
            //     error: function () {
            //         toastr.error('Error');
            //     },
            //     complete: function () {
            //     }
            // })

        })


    </script>
</body>

</html>